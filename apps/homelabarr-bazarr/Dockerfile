## This file is automatically generated (based on release.json)
##
## Do not changes any lines here
##
#####################################
# Docker owned homelabarr           #
# Docker Maintainer smashingtags    #
#####################################
# shellcheck disable=SC2086
# shellcheck disable=SC2046
FROM ghcr.io/smashingtags/homelabarr-alpine-v3:latest

LABEL org.opencontainers.image.source="https://github.com/smashingtags/homelabarr-containers"

ARG TARGETPLATFORM
ARG BUILDPLATFORM

ARG VERSION="1.2.1"
ARG BRANCH="master"

ENV TZ="Etc/UTC"

RUN \
  echo "**** install packages ****" && \
    apk add -U --update --no-cache curl jq ffmpeg libxml2 libxslt py3-pip python3 unzip && \
    apk add -U --update --no-cache --virtual=build-dependencies build-base cargo g++ gcc jq libffi-dev libxml2-dev libxslt-dev python3-dev && \
    apk add -U --update --no-cache --repository http://dl-cdn.alpinelinux.org/alpine/v3.14/main unrar && \
  echo "**** install 'docker-bazarr' ****" && \
    curl -o /tmp/bazarr.zip -L "https://github.com/morpheus65535/bazarr/releases/download/v${VERSION}/bazarr.zip" && \
    mkdir -p /app/bazarr/bin && \
    unzip /tmp/bazarr.zip -d /app/bazarr/bin && \
    rm -Rf /app/bazarr/bin/bin \
          /tmp/bazarr.zip && \
  echo -e "UpdateMethod=docker\nBranch=${BRANCH}\nPackageVersion=${VERSION}\nPackageAuthor=[homelabarr.com](https://homelabarr.com)" > /app/bazarr/package_info && \
  echo "**** Install requirements ****" && \
   pip3 install -U --no-cache-dir pip && \
    pip install lxml --no-binary :all: && \
    pip install -U --no-cache-dir --find-links https://wheel-index.linuxserver.io/alpine/ -r /app/bazarr/bin/requirements.txt && \
  echo "**** cleanup ****" && \
    apk del --purge build-dependencies && \
   rm -rf /root/.cache /root/.cargo /tmp/

COPY --chown=abc ./apps/docker-bazarr/root/ /

EXPOSE 6767

VOLUME /config
##EOF
